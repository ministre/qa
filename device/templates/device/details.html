{% extends "device/wrapper.html" %}

{% load i18n static %}

{% block content %}

<p><a href="{% url 'devices' %}">{% trans "Devices" %}</a> &raquo; {{ device.vendor }} {{ device.model }} ({{ device.hw }})</p>

<ul class="tabs" data-tabs id="device-tabs">
    <li class="tabs-title{% if tab_id == 1 %} is-active{% endif %}">
        <a href="#general" aria-selected="true">{% trans "General" %}</a></li>
    <li class="tabs-title{% if tab_id == 2 %} is-active{% endif %}">
        <a data-tabs-target="spec" href="#spec">{% trans "Specifications" %}</a></li>
    <li class="tabs-title{% if tab_id == 3 %} is-active{% endif %}">
        <a data-tabs-target="firmware" href="#firmware">{% trans "Firmware" %}</a></li>
    <li class="tabs-title{% if tab_id == 4 %} is-active{% endif %}">
        <a data-tabs-target="photo" href="#photo">{% trans "Photo" %}</a></li>
    <li class="tabs-title{% if tab_id == 5 %} is-active{% endif %}">
        <a data-tabs-target="doc" href="#doc">{% trans "Documentation" %}</a></li>
    <li class="tabs-title{% if tab_id == 6 %} is-active{% endif %}">
        <a data-tabs-target="samples" href="#samples">{% trans "Samples" %}</a></li>
    <li class="tabs-title{% if tab_id == 7 %} is-active{% endif %}">
        <a data-tabs-target="protocols" href="#protocols">{% trans "Protocols" %}</a></li>
    <li class="tabs-title{% if tab_id == 8 %} is-active{% endif %}">
        <a data-tabs-target="redmine" href="#redmine">{% trans "Redmine" %}</a></li>
</ul>

<div class="tabs-content" data-tabs-content="device-tabs">
    <div class="tabs-panel{% if tab_id == 1 %} is-active{% endif %}" id="general">
        <a href="{% url 'device_update' pk=device.id %}" class="button small">{% trans "Update" %}</a>
        <a href="{% url 'device_delete' pk=device.id %}" class="button alert small">{% trans "Delete" %}</a>

        <table class="hover unstriped">
            <tbody>
            <tr>
                <td>{% trans "Type" %}:</td>
                <td>{{ device.type }}</td>
            </tr>
            <tr>
                <td>{% trans "Vendor" %}:</td>
                <td>{{ device.vendor }}</td>
            </tr>
            <tr>
                <td>{% trans "Model" %}:</td>
                <td>{{ device.model }}</td>
            </tr>
            <tr>
                <td>{% trans "HW" %}:</td>
                <td>{{ device.hw }}</td>
            </tr>
            <tr>
                <td>{% trans "Created" %}:</td>
                <td>{{ device.created_at }} ({{ device.created_by }})</td>
            </tr>
            <tr>
                <td>{% trans "Last Update" %}:</td>
                <td>{{ device.updated_at }} ({{ device.updated_by }})</td>
            </tr>
            </tbody>
        </table>
    </div>

    <div class="tabs-panel{% if tab_id == 2 %} is-active{% endif %}" id="spec">
        <a href="{% url 'device_update_spec' pk=device.id %}" class="button small">{% trans "Update" %}</a>
        {% for spec in specs %}
        <ul style="list-style: none">
            <li>
                <b>{{ spec.name }}:</b>
                {% for value in spec.values %}
                <ul style="list-style: none">
                    <li>{{ value }}</li>
                </ul>
                {% endfor %}
            </li>
        </ul>
        {% endfor %}
    </div>

    <div class="tabs-panel{% if tab_id == 3 %} is-active{% endif %}" id="firmware">
        <a href="{% url 'firmware_create' device_id=device.id %}" class="button small">{% trans "Add" %}</a>

        <p>
            {% for fw in fws %}
            <a href="{% url 'firmware_update' device_id=device.id pk=fw.id %}">{{ fw.version }}</a>
            <a href="{% url 'firmware_delete' device_id=device.id pk=fw.id %}"><i class="step fi-minus" style="color: #bc104b"></i></a>
            <br>
            {% endfor %}
        </p>

    </div>

    <div class="tabs-panel{% if tab_id == 4 %} is-active{% endif %}" id="photo">
        <a href="{% url 'photo_create' device_id=device.id %}" class="button small">{% trans "Add" %}</a>

        {% if photos %}

        <div class="product-image-gallery">
            <ul class="menu product-thumbs align-center">
                {% for photo in photos %}
                  <li> <a class="sim-thumb" data-image="{{ photo.photo.url }}">
                      <img src="{{ photo.photo.url }}" height="100" width="100" alt="{{ photo.desc }}"></a> </li>
                {% endfor %}
            </ul>

            <p align="center">
                <img class="pdp-product-image" id="main-product-image" src="{{ photos.0.photo.url }}"
                     alt="" style="max-width: 800px">
            </p>
            <br>

        </div>
        {% endif %}

        <p>
            {% for photo in photos %}
            {{ photo.desc }}<br>
            <a href="{% url 'photo_update' device_id=device.id pk=photo.id %}">{{ photo.photo }}</a>
            <a href="{% url 'photo_delete' device_id=device.id pk=photo.id %}"><i class="step fi-minus" style="color: #bc104b"></i></a><br>
            <br>
            {% endfor %}
        </p>

    </div>

    <div class="tabs-panel{% if tab_id == 5 %} is-active{% endif %}" id="doc">
        <a href="{% url 'docum_create' device_id=device.id %}" class="button small">{% trans "Add" %}</a>
        <p>
            {% for docum in docums %}
            {{ docum.type }}<br>
            <a href="{% url 'docum_update' device_id=device.id pk=docum.id %}">{{ docum.file }}</a>
            <a href="{% url 'docum_delete' device_id=device.id pk=docum.id %}"><i class="step fi-minus" style="color: #bc104b"></i></a><br>
            <br>
            {% endfor %}
        </p>
    </div>

    <div class="tabs-panel{% if tab_id == 6 %} is-active{% endif %}" id="samples">
        <a href="{% url 'sample_create' device_id=device.id %}" class="button small">{% trans "Add" %}</a>
        {% if samples %}
        <table id="t_samples" class="display" style="width:100%">
            <thead>
            <tr>
                <th>ID</th>
                <th>{% trans "Serial Number" %}</th>
                <th>{% trans "User Login" %}</th>
                <th>{% trans "User Password" %}</th>
                <th>{% trans "Support Login" %}</th>
                <th>{% trans "Support Password" %}</th>
                <th>{% trans "Description" %}</th>
            </tr>
            </thead>
            <tbody>
        {% endif %}
            {% for sample in samples %}
        <tr data-href="{% url 'sample_update' device_id=device.id pk=sample.id %}">
            <td>{{ sample.id }}</td>
            <td>{{ sample.sn }}</td>
            <td>{{ sample.user_login }}</td>
            <td>{{ sample.user_password }}</td>
            <td>{{ sample.support_login }}</td>
            <td>{{ sample.support_password }}</td>
            <td>{% if sample.desc %}
                  {{ sample.desc }}
                {% endif %}
            </td>
        </tr>
            {% endfor %}
        {% if samples %}
            </tbody>
        </table>
        {% endif %}
    </div>

    <div class="tabs-panel{% if tab_id == 7 %} is-active{% endif %}" id="protocols">
        <a href="{% url 'protocol_create' device_id=device.id %}" class="button small">{% trans "Add" %}</a>
        {% if protocols %}
        <table id="t_protocols" class="display" style="width:100%">
            <thead>
            <tr>
                <th>ID</th>
                <th>{% trans "Firmware" %}</th>
                <th>{% trans "Status" %}</th>
                <th>{% trans "Started" %}</th>
                <th>{% trans "Completed" %}</th>
                <th>{% trans "Created by" %}</th>
                <th></th>
            </tr>
            </thead>
            <tbody>
        {% endif %}
            {% for protocol in protocols %}
        <tr data-href="{% url 'protocol_details' pk=protocol.id %}">
            <td>{{ protocol.id }}</td>
            <td>{{ protocol.firmware }}</td>
            <td>
                {% if protocol.status == None %}
                Testing in progress
                {% else %}
                {{ protocol.status }}
                {% endif %}
            </td>
            <td>{{ protocol.started }}</td>
            <td>
                {% if protocol.completed != None %}
                {{ protocol.completed }}
                {% endif %}
            </td>
            <td>{{ protocol.created_by }}</td>
            <td>
                <a href="{% url 'protocol_update' device_id=device.id pk=protocol.id %}"><i class="step fi-pencil"></i></a>
                <a href="{% url 'protocol_delete' device_id=device.id pk=protocol.id %}"><i class="step fi-minus" style="color: #bc104b"></i></a>
            </td>
        </tr>
            {% endfor %}
        {% if protocols %}
            </tbody>
        </table>
        {% endif %}
    </div>

  <div class="tabs-panel{% if tab_id == 8 %} is-active{% endif %}" id="redmine">
      {% if device.redmine_project %}

      <form method="post" action="{% url 'export_device' %}">
          {% csrf_token %}
          <input type="hidden" name="device" value="{{ device.id }}">
          <input type="submit" value='{% trans "Export" %}' class="button success small" />
      </form>

      <table>
          <tr>
              <td>{% trans "Project ID" %}:</td>
              <td>{{ device.redmine_project }}</td>
          </tr>
          <tr>
              <td>{% trans "Project Wiki" %}:</td>
              {% if redmine_wiki.0 %}
              <td><a href="{{ redmine_wiki.1 }}">{{ redmine_wiki.1 }}</a></td>
              {% else %}
              <td>{{ redmine_wiki.1 }}</td>
              {% endif %}
          </tr>
      </table>
      {% else %}
      <a href="{% url 'device_update' pk=device.id %}">{% trans "Project ID is not set" %}</a>
      {% endif %}
  </div>

</div>

<script>
    $(document).ready(function() {
        var table = $('table').DataTable( {

        {% if LANGUAGE_CODE == 'ru' %}
            "language": { "url": "{% static '/DataTables/i18n/Russian.json' %}" },
        {% endif %}

            "pageLength": 100,
            "order": [[ 0, "desc" ]]
        });
    });

    document.addEventListener("DOMContentLoaded", () => {
        const rows = document.querySelectorAll("tr[data-href]");
        rows.forEach(row => {
            row.addEventListener("click", () => {
                window.location.href = row.dataset.href;
            });
        });
    });
</script>

<script>
$('.sim-thumb').on('click', function() {
  $('#main-product-image').attr('src', $(this).data('image'));
})
</script>

<script type="text/javascript" src="{% static 'DataTables/datatables.js' %}"></script>

{% endblock %}