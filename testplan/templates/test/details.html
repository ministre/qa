{% extends "device/wrapper.html" %}

{% load i18n static %}

{% block content %}

<p><a href="{% url 'testplans' tab_id=1 %}">{% trans "Testplan" %}</a> &raquo;
    <a href="{% url 'testplan_details' pk=testplan.id tab_id=3 %}">{{ testplan.name}}</a>
    &raquo; {{ test.name }}
</p>

<ul class="tabs" data-tabs id="test-tabs">
    <li class="tabs-title {% if tab_id == 1 %} is-active{% endif %}">
        <a data-tabs-target="general" href="#general">{% trans "General" %}</a></li>
    <li class="tabs-title {% if tab_id == 2 %} is-active{% endif %}">
        <a data-tabs-target="purpose" href="#purpose">{% trans "Purpose" %}</a></li>
    <li class="tabs-title {% if tab_id == 3 %} is-active{% endif %}">
        <a data-tabs-target="procedure" href="#procedure">{% trans "Procedure" %}</a></li>
    <li class="tabs-title {% if tab_id == 4 %} is-active{% endif %}">
        <a data-tabs-target="expected" href="#expected">{% trans "Expected result" %}</a></li>
    <li class="tabs-title {% if tab_id == 5 %} is-active{% endif %}">
        <a data-tabs-target="configs" href="#configs">{% trans "Configurations" %}</a></li>
    <li class="tabs-title {% if tab_id == 6 %} is-active{% endif %}">
        <a data-tabs-target="images" href="#images">{% trans "Images" %}</a></li>
    <li class="tabs-title {% if tab_id == 7 %} is-active{% endif %}">
        <a data-tabs-target="files" href="#files">{% trans "Files" %}</a></li>
    <li class="tabs-title {% if tab_id == 8 %} is-active{% endif %}">
        <a data-tabs-target="worksheets" href="#worksheets">{% trans "Worksheets" %}</a></li>
    <li class="tabs-title {% if tab_id == 9 %} is-active{% endif %}">
        <a data-tabs-target="links" href="#links">{% trans "Links" %}</a></li>
    <li class="tabs-title {% if tab_id == 10 %} is-active{% endif %}">
        <a data-tabs-target="comments" href="#comments">{% trans "Comments" %}</a></li>
    <li class="tabs-title {% if tab_id == 11 %} is-active{% endif %}">
        <a data-tabs-target="redmine" href="#redmine">{% trans "Redmine" %}</a></li>
</ul>

<div class="tabs-content" data-tabs-content="test-tabs">
    <div class="tabs-panel {% if tab_id == 1 %}is-active{% endif %}" id="general">
        <a href="{% url 'test_update' testplan_id=testplan.id pk=test.id %}" class="button small">
            {% trans "Update" %}</a>
        <a href="{% url 'test_delete' testplan_id=testplan.id pk=test.id %}" class="button alert small">
            {% trans "Delete" %}</a>
        <table class="hover unstriped">
            <tbody>
            <tr>
                <td>{% trans "Category" %}:</td>
                <td>{{ test.category.name }}</td>
            </tr>
            <tr>
                <td>{% trans "Test name" %}:</td>
                <td>{{ test.name }}</td>
            </tr>
            <tr>
                <td>{% trans "Created" %}:</td>
                <td>{{ test.created_at }} ({{ test.created_by }})</td>
            </tr>
            <tr>
                <td>{% trans "Last Update" %}:</td>
                <td>{{ test.updated_at }} ({{ test.updated_by }})</td>
            </tr>
            </tbody>
        </table>
  </div>

  <div class="tabs-panel {% if tab_id == 2 %}is-active{% endif %}" id="purpose">
    <p>{{ test.purpose }}</p>
  </div>

  <div class="tabs-panel {% if tab_id == 3 %}is-active{% endif %}" id="procedure">
    <p>{{ test_procedure|safe }}</p>
  </div>

  <div class="tabs-panel {% if tab_id == 4 %}is-active{% endif %}" id="expected">
    <p>{{ test_expected|safe }}</p>
  </div>

  <div class="tabs-panel {% if tab_id == 5 %}is-active{% endif %}" id="configs">
      <a href="{% url 'test_config_create' testplan_id=testplan.id test_id=test.id %}" class="button small">
          {% trans "Add" %}</a>
      {% for config in configs %}
      {% if config.name %}<p>{{ config.name }}</p>{% endif %}
      <pre><code data-language="{{ config.lang }}">{{ config.config }}</code></pre>
      <a href="{% url 'test_config_update' testplan_id=testplan.id test_id=test.id pk=config.id %}" class="button small">Update</a>
      <a href="{% url 'test_config_delete' testplan_id=testplan.id test_id=test.id pk=config.id %}" class="button small alert">Delete</a>
      {% endfor %}
  </div>

  <div class="tabs-panel {% if tab_id == 6 %}is-active{% endif %}" id="images">
      <a href="{% url 'test_image_create' testplan_id=testplan.id test_id=test.id %}" class="button small">
          {% trans "Add" %}</a>
      {% for image in images %}
      <p>{{ image.name }}</p>
      <p><img src="{{ image.image.url }}"
              {% if image.width != None %} width="{{ image.width }}" {% endif %}
              {% if image.height != None %} height="{{ image.height }}" {% endif %}
      ></p>
      <a href="{% url 'test_image_update' testplan_id=testplan.id test_id=test.id pk=image.id %}" class="button small">Update</a>
      <a href="{% url 'test_image_delete' testplan_id=testplan.id test_id=test.id pk=image.id %}" class="button small alert">Delete</a>
      {% endfor %}
  </div>

  <div class="tabs-panel {% if tab_id == 7 %}is-active{% endif %}" id="files">
      <a href="{% url 'test_file_create' testplan_id=testplan.id test_id=test.id %}" class="button small">
          {% trans "Add" %}</a>
      {% for file in files %}
      <p><a href="{{ file.file.url }}">{{ file.name }}</a></p>
      <a href="{% url 'test_file_update' testplan_id=testplan.id test_id=test.id pk=file.id %}" class="button small">Update</a>
      <a href="{% url 'test_file_delete' testplan_id=testplan.id test_id=test.id pk=file.id %}" class="button small alert">Delete</a>
      {% endfor %}
  </div>

  <div class="tabs-panel {% if tab_id == 8 %}is-active{% endif %}" id="worksheets">
      <a href="{% url 'test_worksheet_create' testplan_id=testplan.id test_id=test.id %}" class="button small">
          {% trans "Add" %}</a>
      {% for worksheet in worksheets %}
      <ul style="list-style: none">
          <li>
              <b>{{ worksheet.name }}</b>
              <a href="{% url 'test_worksheet_update' testplan_id=testplan.id test_id=test.id pk=worksheet.id %}">
                  <i class="step fi-pencil"></i></a>
              <a href="{% url 'test_worksheet_delete' testplan_id=testplan.id test_id=test.id pk=worksheet.id %}">
                  <i class="step fi-minus" style="color: #bc104b"></i></a>
              {% for item in worksheet.items %}
              <ul style="list-style: none">
                  <li>
                      <i class="fi-checkbox"></i> {{ item.name }}
                      <a href="{% url 'worksheet_item_update' testplan_id=testplan.id test_id=test.id pk=item.id %}">
                          <i class="step fi-pencil"></i></a>
                      <a href="{% url 'worksheet_item_delete' testplan_id=testplan.id test_id=test.id pk=item.id %}">
                          <i class="step fi-minus" style="color: #bc104b"></i></a>
                  </li>
              </ul>
              {% endfor %}
              <blockquote>
                  <a href="{% url 'worksheet_item_create' testplan_id=testplan.id test_id=test.id worksheet_id=worksheet.id %}">
                  <i class="step fi-plus"></i></a>
              </blockquote>

          </li>
      </ul>
      {% endfor %}
  </div>

  <div class="tabs-panel {% if tab_id == 9 %}is-active{% endif %}" id="links">
      <a href="{% url 'test_link_create' testplan_id=testplan.id test_id=test.id %}" class="button small">
          {% trans "Add" %}</a>
      {% for link in links %}

      <table>
          <tr>
              <td>{{ link.name }}</td>
          </tr>
          <tr>
              <td><a href="{{ link.url }}">{{ link.url }}</a></td>
          </tr>
      </table>

      <a href="{% url 'test_link_update' testplan_id=testplan.id test_id=test.id pk=link.id %}" class="button small">Update</a>
      <a href="{% url 'test_link_delete' testplan_id=testplan.id test_id=test.id pk=link.id %}" class="button small alert">Delete</a>
      {% endfor %}
  </div>

  <div class="tabs-panel {% if tab_id == 10 %}is-active{% endif %}" id="comments">
      <a href="{% url 'test_comment_create' testplan_id=testplan.id test_id=test.id %}" class="button small">
          {% trans "Add" %}</a>
      {% for comment in comments %}
        <h5>{{ comment.name }}</h5>
        <p>{{ comment.text|safe }}</p>
        <a href="{% url 'test_comment_update' testplan_id=testplan.id test_id=test.id pk=comment.id %}" class="button small">
            {% trans "Update" %}</a>
        <a href="{% url 'test_comment_delete' testplan_id=testplan.id test_id=test.id pk=comment.id %}"
           class="button small alert">{% trans "Delete" %}</a>
      {% endfor %}
  </div>

  <div class="tabs-panel {% if tab_id == 11 %}is-active{% endif %}" id="redmine">

      <div class="grid-x grid-margin-x small-up-2 medium-up-2">
            <div class="cell">
                <div class="card">
                  <div class="card-section">
                    <h4>Export</h4>
                    <p>Click to send test details to Redmine Wiki.</p>
                      <form method="post" action="{% url 'export_test' %}">
                          {% csrf_token %}
                          <input type="hidden" name="test" value="{{ test.id }}">
                          {% if test.redmine_wiki and project.0 %}
                            <input type="submit" value='{% trans "Export" %}' class="button success small" />
                          {% else %}
                            <p class="button small disabled">{% trans "Export" %}</p>
                          {% endif %}
                      </form>
                  </div>
                </div>
            </div>
            <div class="cell">
                <div class="card">
                  <div class="card-section">
                    <h4>Import</h4>
                    <p>Click to update test details from Redmine Wiki.</p>
                      <form method="post" action="/redmine/import_p_test_details/">
                          {% csrf_token %}
                          <input type="hidden" name="test_id" value="{{ test.id }}">
                          <input type="hidden" name="testplan_id" value="{{ testplan.id }}">
                          <input type="hidden" name="redmine_url" value="{{ test.redmine_url }}">
                          <input type="hidden" name="tag" value="{{ testplan.device_type.tag }}">
                          {% if wiki.0 %}
                            <input type="submit" value='{% trans "Import" %}' class="button alert small" />
                          {% else %}
                            <p class="button small disabled">{% trans "Import" %}</p>
                          {% endif %}
                      </form>
                  </div>
                </div>
            </div>
      </div>

      <div class="grid-x grid-margin-x">
            <div class="cell">
                <div class="card">
                  <div class="card-section">
                    <h4>Project Information</h4>
                      <table>
                          <tr>
                              <td>ID:</td>
                              <td>
                                  {% if testplan.redmine_project %}
                                    <img src="{% static '/img/ok.png' %}" width="25" height="25" alt="ok">
                                    {% trans "Adjusted" %} ({{ testplan.redmine_project }})
                                  {% else %}
                                    <img src="{% static '/img/nok.png' %}" width="25" height="25" alt="nok">
                                    <a href="{% url 'testplan_update' pk=testplan.id %}">{% trans "Not specified" %}</a>
                                  {% endif %}
                              </td>
                          </tr>
                          {% if testplan.redmine_project %}
                          <tr>
                              <td>Wiki:</td>
                              <td>
                                  {% if test.redmine_wiki %}
                                    <img src="{% static '/img/ok.png' %}" width="25" height="25" alt="ok">
                                    {% trans "Adjusted" %} ({{ test.redmine_wiki }})
                                  {% else %}
                                    <img src="{% static '/img/nok.png' %}" width="25" height="25" alt="nok">
                                    <a href="{% url 'test_update' testplan_id=testplan.id pk=test.id %}">
                                        {% trans "Not specified" %}</a>
                                  {% endif %}
                              </td>
                          </tr>
                          <tr>
                              <td>Check Project:</td>
                              <td>
                                  {% if project.0 %}
                                    <img src="{% static '/img/ok.png' %}" width="25" height="25" alt="ok">
                                  Found
                                  {% else %}
                                    <img src="{% static '/img/nok.png' %}" width="25" height="25" alt="nok">
                                  {{ project.1 }}
                                  {% endif %}
                              </td>
                          </tr>
                          {% if test.redmine_wiki and project.0 %}
                          <tr>
                              <td>Check Wiki page:</td>
                              <td>
                                  {% if wiki.0 %}
                                    <img src="{% static '/img/ok.png' %}" width="25" height="25" alt="ok"> Found
                                  {% else %}
                                    <img src="{% static '/img/nok.png' %}" width="25" height="25" alt="nok">
                                  {{ wiki.1 }}
                                  {% endif %}
                              </td>
                          </tr>
                          {% endif %}
                          {% if wiki.0 %}
                            <tr>
                                <td>Wiki URL:</td>
                                <td><a href="{{ wiki.1 }}">{{ wiki.1 }}</a></td>
                            </tr>
                          {% endif %}
                          {% endif %}
                      </table>
                  </div>
                </div>
            </div>
      </div>

  </div>
</div>

<script src="{% static 'rainbow/rainbow-custom.min.js' %}"></script>

{% endblock %}
